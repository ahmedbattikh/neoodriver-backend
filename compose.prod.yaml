---
# Production environment override
services:
  php:
    build:
      context: .
      target: frankenphp_prod
    environment:
      APP_SECRET: ${APP_SECRET}
      SERVER_NAME: ${SERVER_NAME}
      DEFAULT_URI: ${DEFAULT_URI}
      # Disable automatic HTTPS in Caddy; TLS is terminated by Nginx on host
      CADDY_GLOBAL_OPTIONS: auto_https off
    # Bind HTTP only to localhost:8080 to avoid conflicts with host Nginx/Caddy
    ports:
      - "127.0.0.1:8080:80"

  phpmyadmin:
    image: phpmyadmin:latest
    restart: unless-stopped
    depends_on:
      mysql:
        condition: service_healthy
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
      PMA_USER: ${PMA_USER:-neooadmin}
      PMA_PASSWORD: ${PMA_PASSWORD:-NeooDriver@9090}
    ports:
      - "127.0.0.1:8081:80"
